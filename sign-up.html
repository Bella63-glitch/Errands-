<!doctype html>
<html lang="en"> 
 <head> 
  <meta charset="UTF-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <title>Create account- Sign Up</title> 
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-64SH312S1V"></script> 
  <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-64SH312S1V');
    </script> 
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"> 
  <style>
    /* Custom CSS for colors and specific elements not handled by Tailwind */
    :root {
        --maroon: #7B1E3A;
        --gold: #FFD700;
    }
    .bg-maroon { background-color: var(--maroon); }
    .text-gold { color: var(--gold); }
    .bg-gold { background-color: var(--gold); }
    .bg-maroon-dark { background-color: #66182f; }  body {
    font-family: sans-serif;
}
.id-info {
    font-size: 0.8em;
    color: #666;
    margin-top: 5px;
    font-weight: normal;
}
.popup {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 15px;
    border-radius: 5px;
    display: none;
    color: white;
    font-weight: bold;
    z-index: 1000;
}
.popup.success { background: green; }
.popup.error { background: red; }
.payment-notice {
    background-color: #fffbeb; /* A soft, light yellow background */
    border-left: 4px solid var(--gold);
    color: #4a5568;
    padding: 16px;
    border-radius: 8px;
}
.payment-notice p {
    margin: 0;
}
.payment-notice h4 {
    font-weight: bold;
    color: var(--maroon);
    margin-bottom: 8px;
}
.runner-intro {
    background-color: #fcece0; /* New, softer peachy/orange background */
    border: 1px solid #d4a77d; /* A complementary border */
    color: #4a5568;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
    font-size: 0.95em;
}
.runner-intro h4 {
    color: var(--maroon);
}

</style> 
 </head> 
 <body class="bg-gray-100 text-gray-800 font-sans min-h-screen flex flex-col"> 
  <header class="bg-maroon shadow-lg sticky top-0 z-50"> 
   <div class="max-w-7xl mx-auto flex justify-between items-center py-5 px-6"> <a href="/" class="flex items-center space-x-2"> <img src="https://i.postimg.cc/d1z9KLkL/ei-1752053865516-removebg-preview.png" alt="Errand Logo" class="h-20 md:h-24 w-auto"> <h1 class="text-3xl md:text-5xl font-bold text-white transition-colors duration-300 hover:text-gold" style="text-shadow: 1px 1px 2px rgba(0,0,0,0.4);"><strong>Run Me An Errand</strong></h1> </a> 
   </div> 
  </header> 
  <main class="flex-grow flex justify-center items-center p-4"> 
   <div class="signup-container w-full max-w-lg bg-white p-8 rounded-xl shadow-md my-8"> 
    <h2 class="text-3xl text-center font-bold text-maroon mb-6">Sign Up</h2> 
    <div id="runnerIntro" class="runner-intro" style="display:none;"> 
     <h4 class="font-bold text-lg mb-2">ðŸ‘‹ Welcome to Kenyaâ€™s Trusted Errand Runners Directory!</h4> 
     <p>Earn money by completing simple errands in your area.</p> 
     <p>Fill out this quick form to create your professional profile. Your **KES 100 monthly subscription** gives you verified status and visibility to clients who will contact you directly!</p> 
    </div> <label for="accountType" class="block font-semibold text-maroon mb-2">Account Type</label> <select id="accountType" class="block w-full border border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:ring-1 focus:ring-maroon focus:border-maroon mb-4"> <option value="user">User (Free)</option> <option value="runner">Runner (KES 100/month)</option> </select> <label for="fullName" class="block font-semibold text-maroon mb-2">Full Name</label> 
    <input type="text" id="fullName" class="block w-full border border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:ring-1 focus:ring-maroon focus:border-maroon mb-4"> <label for="email" class="block font-semibold text-maroon mb-2">Email</label> 
    <input type="email" id="email" class="block w-full border border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:ring-1 focus:ring-maroon focus:border-maroon mb-4"> <label for="phone" class="block font-semibold text-maroon mb-2">Phone</label> 
    <input type="text" id="phone" class="block w-full border border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:ring-1 focus:ring-maroon focus:border-maroon mb-4"> <label for="password" class="block font-semibold text-maroon mb-2">Password</label> 
    <input type="password" id="password" class="block w-full border border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:ring-1 focus:ring-maroon focus:border-maroon mb-4"> <label for="location" class="block font-semibold text-maroon mb-2">Location</label> 
    <input type="text" id="location" placeholder="e.g., Nairobi, Kenya" class="block w-full border border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:ring-1 focus:ring-maroon focus:border-maroon mb-4"> 
    <div id="runnerFields" class="space-y-4" style="display:none;"> 
     <div> <label for="profilePicture" class="block font-semibold text-maroon mb-2">Upload Profile Picture</label> 
      <input type="file" id="profilePicture" accept="image/*" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-maroon file:text-gold hover:file:bg-maroon-dark"> 
     </div> 
     <div> <label for="about" class="block font-semibold text-maroon mb-2 mt-4">About Me</label> <textarea id="about" rows="3" placeholder="Tell us a little about yourself..." class="block w-full border border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:ring-1 focus:ring-maroon focus:border-maroon"></textarea> 
     </div> 
     <div> <label for="idNumber" class="block font-semibold text-maroon mb-2">ID Number</label> 
      <input type="text" id="idNumber" class="block w-full border border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:ring-1 focus:ring-maroon focus:border-maroon"> 
     </div> 
     <div> <label for="idPicture" class="block font-semibold text-maroon mb-2"> Upload ID Picture <p class="id-info text-gray-500 font-normal">We require your ID for verification and security to build trust within our community.</p> </label> 
      <input type="file" id="idPicture" accept="image/*" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-maroon file:text-gold hover:file:bg-maroon-dark"> 
     </div> 
     <div> <label for="experience" class="block font-semibold text-maroon mb-2">Experience</label> <textarea id="experience" rows="3" placeholder="Describe your experience as an errand runner..." class="block w-full border border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:ring-1 focus:ring-maroon focus:border-maroon"></textarea> 
     </div> 
     <div> <label for="availability" class="block font-semibold text-maroon mb-2">Availability</label> 
      <input type="text" id="availability" placeholder="e.g., Weekends, Mon-Fri 9am-5pm" class="block w-full border border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:ring-1 focus:ring-maroon focus:border-maroon"> 
     </div> 
    </div> <button onclick="signUp()" class="w-full bg-maroon text-gold font-bold py-2 px-4 rounded-md mt-6 hover:bg-maroon-dark transition-colors duration-300">Sign Up</button> 
    <div id="paymentNotice" class="payment-notice mt-4"></div> 
   </div> 
  </main> 
  <div class="popup" id="popup"></div> 
  <footer class="bg-gray-800 text-gray-300 py-6"> 
   <div class="max-w-7xl mx-auto px-6 text-center"> 
    <p class="text-sm">Â© 2025 Run Me An Errand. All rights reserved.</p> 
   </div> 
  </footer> 
  <script>
const APP_ID = "9223CBD1-9AFC-4C74-B56B-12F11D319DF9";
const API_KEY = "0C3700EB-013B-4BFE-85ED-CE0F6F7EC013";
const PochiLaBiasharaNumber = "0115815194"; // CORRECTED NUMBER
const VerificationNumber = "0797046378";

const accountTypeSelect = document.getElementById("accountType");
const runnerFields = document.getElementById("runnerFields");
const paymentNotice = document.getElementById("paymentNotice");
const runnerIntro = document.getElementById("runnerIntro");

function updatePaymentNotice() {
const accountType = accountTypeSelect.value;
const feeAmount = 100;
let message;

if (accountType === "runner") {
    
    // Updated Payment Notice Text with corrected Pochi number
    message = `
        <h4 class="font-bold text-maroon mb-2">âœ… Complete Your Subscription (KES ${feeAmount})</h4>
        <p class="mt-2 font-bold">To finalize and activate your runner profile, please complete your first monthly payment:</p>
        <ol class="list-decimal list-inside mt-2 text-sm space-y-1">
            <li>Send **KES ${feeAmount}** to our Pochi la Biashara account: <b>${PochiLaBiasharaNumber}</b></li>
            <li>Forward the M-Pesa confirmation message to: <b>${VerificationNumber}</b></li>
        </ol>
        <p class="mt-2 text-sm italic">Once verified, your profile will be live and clients can contact you for errands!</p>
    `;
    paymentNotice.innerHTML = message;
    paymentNotice.style.display = "block";
} else { // accountType === "user"
    // Updated User Message to reflect browsing runners
    paymentNotice.innerHTML = `
        <h4>Open an account today and find the perfect runner!</h4>
        <p>Your account is free and will be activated immediately. Browse our list of verified runners and hire help today!</p>
    `;
    paymentNotice.style.display = "block";
}

}

function updateFormVisibility() {
if (accountTypeSelect.value === "runner") {
    runnerFields.style.display = "block";
    runnerIntro.style.display = "block"; 
} else {
    runnerFields.style.display = "none";
    runnerIntro.style.display = "none"; 
}
}

accountTypeSelect.addEventListener("change", () => {
updateFormVisibility();
updatePaymentNotice();
});
document.addEventListener("DOMContentLoaded", () => {
updateFormVisibility();
updatePaymentNotice();
});

function showPopup(message, type, duration = 4000) {
const popup = document.getElementById("popup");
popup.textContent = message;
popup.className = "popup " + type;
popup.style.display = "block";
setTimeout(() => { popup.style.display = "none"; }, duration);
}

async function signUp() {
const accountType = document.getElementById("accountType").value;
const fullName = document.getElementById("fullName").value;
const email = document.getElementById("email").value;
const phone = document.getElementById("phone").value;
const password = document.getElementById("password").value;
const location = document.getElementById("location").value;

let about = "";
let imageUrl = "";
let idNumber = "";
let idPictureUrl = "";
let experience = "";
let availability = "";

if (!fullName || !email || !phone || !password || !location) {
    showPopup("Please fill all required fields", "error");
    return;
}

if (accountType === "runner") {
    about = document.getElementById("about").value;
    const profilePictureFile = document.getElementById("profilePicture").files[0];
    idNumber = document.getElementById("idNumber").value;
    const idPictureFile = document.getElementById("idPicture").files[0];
    experience = document.getElementById("experience").value;
    availability = document.getElementById("availability").value;


    if (!about || !profilePictureFile || !idNumber || !idPictureFile || !experience || !availability) {
        showPopup("Please provide all required Runner details", "error");
        return;
    }

    try {
        const profilePicFormData = new FormData();
        profilePicFormData.append("file", profilePictureFile);
        const profilePicUploadRes = await fetch(`https://api.backendless.com/${APP_ID}/${API_KEY}/files/profiles/${profilePictureFile.name}`, {
            method: "POST",
            body: profilePicFormData
        });

        if (!profilePicUploadRes.ok) {
            const error = await profilePicUploadRes.json();
            throw new Error(error.message || "Failed to upload profile picture.");
        }
        const profilePicData = await profilePicUploadRes.json();
        imageUrl = profilePicData.fileURL;

        const idPicFormData = new FormData();
        idPicFormData.append("file", idPictureFile);
        const idPicUploadRes = await fetch(`https://api.backendless.com/${APP_ID}/${API_KEY}/files/ids/${idPictureFile.name}`, {
            method: "POST",
            body: idPicFormData
        });

        if (!idPicUploadRes.ok) {
            const error = await idPicUploadRes.json();
            throw new Error(error.message || "Failed to upload ID picture.");
        }
        const idPicData = await idPicUploadRes.json();
        idPictureUrl = idPicData.fileURL;

    } catch (error) {
        console.error("Image upload error:", error);
        showPopup(error.message || "An error occurred during image upload. Please try again.", "error");
        return;
    }
}

const userData = {
    name: fullName,
    email,
    phone,
    password,
    location,
    profiletype: accountType,
    role: accountType,
    about: about,
    imageurl: imageUrl,
    idNumber,
    idimage: idPictureUrl,
    experience,
    availability,
    isavailable: false,
    SubscriptionStatus: (accountType === 'user') ? true : false,
    // THE FIX: Force the account to be enabled
    isEnabled: true
};

const res = await fetch(`https://api.backendless.com/${APP_ID}/${API_KEY}/users/register`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(userData)
});

if (res.ok) {
    let successMessage;
    if (accountType === 'user') {
        // Updated success message for user
        successMessage = "Sign up successful! Your account is now active. Browse runners and hire your help today!";
    } else {
        successMessage = "Sign up successful! Your account is pending activation. We will verify your KES 100 payment and send you an email shortly to confirm and tell you how to login.";
    }
    showPopup(successMessage, "success", 7000);

    document.querySelector("input#fullName").value = '';
    document.querySelector("input#email").value = '';
    document.querySelector("input#phone").value = '';
    document.querySelector("input#password").value = '';
    document.querySelector("input#location").value = '';
    if (accountType === "runner") {
      document.querySelector("input#profilePicture").value = '';
      document.querySelector("textarea#about").value = '';
      document.querySelector("input#idNumber").value = '';
      document.querySelector("input#idPicture").value = '';
      document.querySelector("textarea#experience").value = '';
      document.querySelector("input#availability").value = '';
    }

} else {
    const error = await res.json();
    showPopup(error.message || "Sign up failed", "error");
}

}
</script> 
 </body>
</html>
