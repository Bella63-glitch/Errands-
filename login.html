<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Runner Profile - Run Me An Errand</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    :root {
      --maroon: #7B1E3A;
      --gold: #FFD700;
      --light-bg: #f0f4f8; /* Softer background */
      --text-dark: #333;
      --border-light: #e0e0e0;
    }/* Page layout */
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  margin: 0;
  background: var(--light-bg);
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 2.5rem 1rem;
  color: var(--text-dark);
}

/* Header */
header.site-header {
  width: 100%;
  max-width: 880px;
  background: var(--maroon);
  color: white;
  padding: 14px 20px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  box-shadow: 0 8px 24px rgba(0,0,0,0.06);
  margin-bottom: 1.25rem;
}
.brand { display:flex; gap:12px; align-items:center; text-decoration:none; color:white }
.brand .logo { width:44px; height:44px; border-radius:8px; background:#ffffff22; display:flex; align-items:center; justify-content:center; font-weight:800 }
nav.header-nav a { color: white; text-decoration: none; margin-left: 12px; font-weight:600 }
nav.header-nav a.home { background: var(--gold); color: var(--maroon); padding:6px 10px; border-radius:8px; margin-left:0 }

/* Card */
.profile-container {
  background-color: #fff;
  border-radius: 14px;
  box-shadow: 0 12px 30px rgba(0, 0, 0, 0.08);
  padding: 2.25rem;
  width: 100%;
  max-width: 880px;
  text-align: center;
  transition: transform 0.3s ease-in-out;
}

.grid {
  display: grid;
  grid-template-columns: 220px 1fr;
  gap: 1.25rem;
  align-items: start;
}

h2 { color: var(--maroon); margin: 0 0 0.5rem 0; font-weight:700 }

.profile-header { display:flex; flex-direction:column; align-items:center }

.profile-pic-wrapper { position: relative; width: 130px; height: 130px; margin-bottom: 0.5rem }
.profile-pic { width:100%; height:100%; border-radius:50%; object-fit:cover; border: 4px solid var(--gold); box-shadow: 0 0 0 3px var(--maroon); background:#f4f4f4 }

.details { text-align:left }
.detail-item { font-size:1.02rem; padding:0.7rem 0; border-bottom:1px solid var(--border-light); display:flex; justify-content:space-between; align-items:center }
.detail-item:last-child { border-bottom:none }
.detail-item strong { color: var(--maroon); font-weight:600; min-width:110px }
.highlight { text-align:right; flex-grow:1; margin-left:12px }

.status-badge { padding:0.35rem 0.7rem; border-radius:20px; color:white; font-weight:700; font-size:0.85rem }
.active { background-color:#28a745 }
.inactive { background-color:#dc3545 }

.button-group { margin-top:1.25rem; display:flex; gap:12px; justify-content:center }
button { background-color:var(--maroon); color:white; border:none; border-radius:8px; padding:10px 18px; cursor:pointer; font-weight:700 }
button:hover { opacity:0.95 }
#editBtn { background: var(--gold); color: var(--maroon) }

/* Popup */
.popup { position: fixed; top: 18px; left:50%; transform: translateX(-50%); background:#333; color:#fff; padding:10px 20px; border-radius:8px; display:none; z-index:1000; font-weight:600; }
.popup.success { background:#28a745 }
.popup.error { background:#dc3545 }
.popup.info { background:#17a2b8 }

/* Edit form: keep visible when shown */
#editMode { display: none }
#editForm { text-align:left; margin-top: 1rem; display:block }
#editForm label { display:block; margin-top:1rem; margin-bottom:0.3rem; font-weight:600; color:var(--maroon) }
#editForm input[type="text"], #editForm textarea { width:100%; padding:10px; border-radius:8px; border:1px solid var(--border-light); font-size:1rem }
#editForm textarea { min-height:84px; resize:vertical }
.edit-actions { display:flex; justify-content:flex-end; gap:10px; margin-top:12px }
#cancelEditBtn { background:#6c757d; color:white; border:none; padding:10px 18px; border-radius:8px }
#imageUploadLabel { display:block; margin-top:8px; padding:10px; background:var(--maroon); color:white; text-align:center; border-radius:8px; cursor:pointer }
#profilePictureInput { display:none }

/* Footer */
footer.site-footer { width:100%; max-width:880px; margin-top:1rem; background:var(--maroon); color:white; padding:12px 20px; border-radius:10px; display:flex; justify-content:space-between; align-items:center }
footer a { color: #fff; text-decoration:none }

/* Responsive */
@media (max-width:820px) {
  .grid { grid-template-columns: 1fr }
  header.site-header, footer.site-footer { padding:12px }
  .profile-container { padding:1.5rem }
}

  </style>
</head>
<body>
  <div id="popup" class="popup"></div>  <!-- Header (maroon) with homepage link -->  <header class="site-header">
    <a class="brand" href="index.html" aria-label="Run Me An Errand home">
      <div class="logo">RME</div>
      <div style="line-height:1">
        <div style="font-weight:700">Run Me An Errand</div>
        <small style="opacity:0.9">Local runners ‚Äî fast & trusted</small>
      </div>
    </a>
    <nav class="header-nav" aria-label="Main navigation">
      <a class="home" href="index.html">Home</a>
      <a href="runners.html">All Runners</a>
      <a href="contact.html">Contact</a>
    </nav>
  </header>  <div class="profile-container">
    <div class="grid">
      <div>
        <div class="profile-header">
          <h2>Runner Profile</h2>
          <div class="profile-pic-wrapper">
            <img id="runnerImage" class="profile-pic" src="https://via.placeholder.com/130/7B1E3A/FFD700?text=R" alt="Profile Picture" />
          </div>
        </div><div class="button-group">
      <button id="editBtn"><i class="fas fa-edit"></i> Edit Profile</button>
      <button id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</button>
    </div>
  </div>

  <div>
    <div class="details" id="runnerDetails">
        <div class="detail-item"><strong>Name:</strong> <span id="runnerName" class="highlight">Loading...</span></div>
        <div class="detail-item"><strong>Email:</strong> <span id="runnerEmail" class="highlight">Loading...</span></div>
        <div class="detail-item"><strong>Phone:</strong> <span id="runnerPhone" class="highlight">Loading...</span></div>
        <div class="detail-item"><strong>About:</strong> <span id="runnerAbout" class="highlight">Loading...</span></div>
        <div class="detail-item"><strong>Experience:</strong> <span id="runnerExperience" class="highlight">Loading...</span></div>
        <div class="detail-item"><strong>Availability:</strong> <span id="runnerAvailability" class="highlight">Loading...</span></div>
        <div class="detail-item"><strong>Location:</strong> <span id="runnerLocation" class="highlight">Loading...</span></div>
        <div class="detail-item"><strong>Status:</strong> <span id="runnerStatus" class="status-badge">Loading...</span></div>
    </div>

    <div id="editMode">
      <form id="editForm">
        <h3>Edit Your Details</h3>

        <label for="profilePictureInput" id="imageUploadLabel"><i class="fas fa-camera"></i> Change Profile Picture</label>
        <input type="file" id="profilePictureInput" accept="image/*">
        <small style="display:block;margin-top:6px;color:#666">Note: Image will update upon saving.</small>

        <label for="editName">Full Name</label>
        <input type="text" id="editName" required>

        <label for="editPhone">Phone</label>
        <input type="text" id="editPhone">

        <label for="editLocation">Location</label>
        <input type="text" id="editLocation">

        <label for="editAvailability">Availability</label>
        <input type="text" id="editAvailability">

        <label for="editExperience">Experience (e.g., 2 years)</label>
        <input type="text" id="editExperience">

        <label for="editAbout">About Me</label>
        <textarea id="editAbout"></textarea>

        <div class="edit-actions">
            <button type="button" id="cancelEditBtn">Cancel</button>
            <button type="submit" id="saveBtn"><i class="fas fa-save"></i> Save Changes</button>
        </div>
      </form>
    </div>
  </div>
</div>

  </div>  <!-- Footer (maroon) with contact info -->  <footer class="site-footer">
    <div>
      <strong>Run Me An Errand</strong>
      <div style="font-size:13px;opacity:0.95">Helping you save time ‚Äî one errand at a time</div>
    </div>
    <div style="text-align:right">
      <div>üìû 0797046378</div>
      <div>‚úâÔ∏è ranmeanerrand@gmail.com</div>
    </div>
  </footer>  <script>
    // Supabase Configuration (left exactly as in your original working file)
    const supabaseUrl = "https://zchofpncqskvnfrzbcww.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpjaG9mcG5jcXNrdm5mcnpiY3d3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk5NDI4NDIsImV4cCI6MjA3NTUxODg0Mn0.U-Zm4slsBcWHSpfhjM8jvBvtt8YCPMAiSopWR9-YXUI";
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
    const BUCKET_NAME = 'profiles';

    // DOM Elements
    const popup = document.getElementById("popup");
    const logoutBtn = document.getElementById("logoutBtn");
    const editBtn = document.getElementById("editBtn");
    const cancelEditBtn = document.getElementById("cancelEditBtn");
    const saveBtn = document.getElementById("saveBtn");
    const viewMode = document.getElementById("viewMode");
    const editMode = document.getElementById("editMode");
    const editForm = document.getElementById("editForm");
    const profilePictureInput = document.getElementById("profilePictureInput");

    // Current User State
    const email = localStorage.getItem("loggedInEmail");
    const userType = localStorage.getItem("userType");
    let currentRunnerData = null; // Store fetched data

    function toggleEditMode(isEditing) {
        viewMode.style.display = isEditing ? "none" : "block";
        editMode.style.display = isEditing ? "block" : "none";
        if (isEditing) {
          // ensure form has fresh values
          populateEditForm(currentRunnerData);
          document.getElementById('editName').focus();
        }
    }

    function showPopup(message, type = "info") {
      popup.textContent = message;
      popup.className = "popup " + type;
      popup.style.display = "block";
      setTimeout(() => (popup.style.display = "none"), 4000);
    }

    function checkLogin() {
        if (!email || userType !== "runner") {
            alert("Session expired. Please log in again.");
            window.location.href = "login.html";
        }
    }

    async function loadRunnerProfile() {
      checkLogin();

      try {
        const { data, error } = await supabase
          .from("runners")
          .select("*")
          .eq("email", email)
          .maybeSingle();

        if (error || !data) {
          console.error("Profile load error:", error);
          showPopup("‚ùå Failed to load profile. Please log in again.", "error");
          setTimeout(() => window.location.href = "login.html", 2000);
          return;
        }

        currentRunnerData = data;
        populateViewMode(data);
        populateEditForm(data);

      } catch (err) {
        console.error("Error fetching profile:", err);
        showPopup("‚ùå Error loading profile", "error");
      }
    }

    function populateViewMode(data) {
        document.getElementById("runnerName").textContent = data.name || "N/A";
        document.getElementById("runnerEmail").textContent = data.email;
        document.getElementById("runnerPhone").textContent = data.phone || "N/A";
        document.getElementById("runnerAbout").textContent = data.about || "N/A";
        document.getElementById("runnerExperience").textContent = data.experience || "N/A";
        document.getElementById("runnerAvailability").textContent = data.availability || "N/A";
        document.getElementById("runnerLocation").textContent = data.location || "N/A";

        const statusSpan = document.getElementById("runnerStatus");
        if (data.subscription_status === "active") {
            statusSpan.textContent = "Active ‚úÖ";
            statusSpan.className = "status-badge active";
        } else {
            statusSpan.textContent = "Inactive ‚ùå";
            statusSpan.className = "status-badge inactive";
        }

        const imgEl = document.getElementById("runnerImage");
        imgEl.src = data.profilepicture || "https://via.placeholder.com/130/7B1E3A/FFD700?text=R";
    }

    function populateEditForm(data) {
        document.getElementById("editName").value = data?.name || "";
        document.getElementById("editPhone").value = data?.phone || "";
        document.getElementById("editLocation").value = data?.location || "";
        document.getElementById("editAvailability").value = data?.availability || "";
        document.getElementById("editExperience").value = data?.experience || "";
        document.getElementById("editAbout").value = data?.about || "";
    }

    async function uploadProfilePicture(file) {
        const fileExtension = file.name.split('.').pop();
        const filePath = `${email}/${Date.now()}.${fileExtension}`;

        try {
            const { error: uploadError } = await supabase.storage
                .from(BUCKET_NAME)
                .upload(filePath, file, {
                    cacheControl: '3600',
                    upsert: true,
                });

            if (uploadError) throw uploadError;

            const { data: publicUrlData } = supabase.storage
                .from(BUCKET_NAME)
                .getPublicUrl(filePath);

            return publicUrlData.publicUrl;

        } catch (error) {
            console.error('Error uploading file:', error);
            showPopup(`‚ùå File upload failed: ${error.message}`, 'error');
            return null;
        }
    }

    async function handleUpdateProfile(e) {
        e.preventDefault();
        saveBtn.disabled = true;
        showPopup("Saving changes...", "info");

        let imageUrl = currentRunnerData?.profilepicture;

        const file = profilePictureInput.files[0];
        if (file) {
            const uploaded = await uploadProfilePicture(file);
            if (!uploaded) { saveBtn.disabled = false; return; }
            imageUrl = uploaded;
        }

        const updatedProfile = {
            name: document.getElementById("editName").value,
            phone: document.getElementById("editPhone").value,
            location: document.getElementById("editLocation").value,
            availability: document.getElementById("editAvailability").value,
            experience: document.getElementById("editExperience").value,
            about: document.getElementById("editAbout").value,
            profilepicture: imageUrl,
        };

        try {
            const { error: updateError } = await supabase
                .from('runners')
                .update(updatedProfile)
                .eq('email', email);

            if (updateError) throw updateError;

            showPopup("‚úÖ Profile updated successfully!", "success");
            await loadRunnerProfile();
            toggleEditMode(false);

        } catch (error) {
            console.error("Update error:", error);
            showPopup(`‚ùå Failed to save profile: ${error.message}`, "error");
        } finally {
            saveBtn.disabled = false;
        }
    }

    // Preview selected image before saving
    profilePictureInput.addEventListener('change', (evt) => {
      const file = evt.target.files[0];
      if (!file) return;
      const imgEl = document.getElementById("runnerImage");
      const reader = new FileReader();
      reader.onload = (e) => { imgEl.src = e.target.result; };
      reader.readAsDataURL(file);
    });

    // Event listeners
    editBtn.addEventListener("click", () => { populateEditForm(currentRunnerData); toggleEditMode(true); });
    cancelEditBtn.addEventListener("click", () => { if (currentRunnerData) { document.getElementById('runnerImage').src = currentRunnerData.profilepicture || 'https://via.placeholder.com/130/7B1E3A/FFD700?text=R'; } profilePictureInput.value = ''; toggleEditMode(false); });
    editForm.addEventListener("submit", handleUpdateProfile);

    logoutBtn.addEventListener("click", () => {
      localStorage.removeItem("loggedInEmail");
      localStorage.removeItem("userType");
      showPopup("Logging out...", "info");
      setTimeout(() => window.location.href = "login.html", 1000);
    });

    // Load profile on page open
    loadRunnerProfile();
  </script></body>
</html>









