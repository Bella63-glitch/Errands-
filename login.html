<!doctype html>
<html lang="en"> 
 <head> 
  <meta charset="UTF-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <title>Login - Run Me An Errand</title> 
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script> 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bcryptjs/2.4.3/bcrypt.min.js"></script> 
  <style>
    :root {
      --maroon: #7B1E3A;
      --gold: #FFD700;
    }

    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(to bottom, #fff, #f5f5f5);
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }

    .login-container {
      background-color: white;
      border-radius: 15px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
      padding: 3rem 2rem;
      width: 100%;
      max-width: 400px;
      text-align: center;
      position: relative;
    }

    h2 {
      color: var(--maroon);
      margin-bottom: 2rem;
      font-size: 2rem;
      font-weight: bold;
    }

    input {
      width: 100%;
      padding: 0.8rem;
      margin: 0.5rem 0;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 1rem;
    }

    input:focus {
      outline: 2px solid var(--gold);
    }

    button {
      width: 100%;
      padding: 0.9rem;
      margin-top: 1rem;
      background-color: var(--maroon);
      color: var(--gold);
      border: none;
      border-radius: 10px;
      font-weight: bold;
      font-size: 1rem;
      cursor: pointer;
      transition: 0.3s;
    }

    button:hover {
      background-color: #66182f;
    }

    .popup {
      position: absolute;
      top: -70px;
      left: 50%;
      transform: translateX(-50%);
      padding: 12px 20px;
      border-radius: 8px;
      font-weight: bold;
      color: white;
      display: none;
      z-index: 10;
      max-width: 90%;
      text-align: center;
    }

    .popup.success { background: green; }
    .popup.error { background: red; }
    .popup.info { background: #ff9900; }

    a {
      display: block;
      margin-top: 1rem;
      color: var(--maroon);
      text-decoration: underline;
      font-weight: bold;
    }
  </style> 
 </head> 
 <body> 
  <div class="login-container"> 
   <div id="popup" class="popup"></div> 
   <h2>Login</h2> 
   <input type="email" id="email" placeholder="Email" required> 
   <input type="password" id="password" placeholder="Password" required> 
   <button id="loginBtn">Login</button> 
   <a href="index.html">← Back to Homepage</a> 
  </div> 

  <script>
    const supabaseUrl = "https://zchofpncqskvnfrzbcww.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpjaG9mcG5jcXNrdm5mcnpiY3d3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk5NDI4NDIsImV4cCI6MjA3NTUxODg0Mn0.U-Zm4slsBcWHSpfhjM8jvBvtt8YCPMAiSopWR9-YXUI";
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

    const loginBtn = document.getElementById("loginBtn");
    const popup = document.getElementById("popup");

    function showPopup(message, type="info") {
      popup.textContent = message;
      popup.className = "popup " + type;
      popup.style.display = "block";
      setTimeout(() => popup.style.display = "none", 4000);
    }

    loginBtn.addEventListener("click", async () => {
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value.trim();

      if (!email || !password) {
        showPopup("⚠️ Please fill all fields", "info");
        return;
      }

      showPopup("Checking credentials...", "info");

      try {
        // Check runners table
        const { data: runner, error: runnerError } = await supabase
          .from("runners")
          .select("*")
          .eq("email", email)
          .maybeSingle();

        if (runnerError) console.error("Runner error:", runnerError);

        if (runner) {
          if (dcodeIO.bcrypt.compareSync(password, runner.password)) {
            if (runner.subscription_status === "active") {
              showPopup("✅ Login successful! Redirecting...", "success");
              localStorage.setItem("loggedInEmail", email);
              localStorage.setItem("userType", "runner");
              setTimeout(() => window.location.href = "runners-profile.html", 1000);
            } else {
              showPopup("❌ Account inactive. Please confirm payment to activate.", "error");
            }
            return;
          } else {
            showPopup("❌ Incorrect password.", "error");
            return;
          }
        }

        // Check users table
        const { data: user, error: userError } = await supabase
          .from("users")
          .select("*")
          .eq("email", email)
          .maybeSingle();

        if (userError) console.error("User error:", userError);

        if (user) {
          if (dcodeIO.bcrypt.compareSync(password, user.password)) {
            showPopup("✅ Login successful! Redirecting...", "success");
            localStorage.setItem("loggedInEmail", email);
            localStorage.setItem("userType", "client");
            setTimeout(() => window.location.href = "client-profile.html", 1000);
            return;
          } else {
            showPopup("❌ Incorrect password.", "error");
            return;
          }
        }

        showPopup("❌ Email not found.", "error");

      } catch (err) {
        console.error("Login error:", err);
        showPopup("❌ Something went wrong. Try again.", "error");
      }
    });
  </script> 
 </body>
</html>


