<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login - Run Me an Errand</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    :root { --maroon:#7B1E3A; --gold:#FFD700; }
    body { background-color: #f3f4f6; }
    .bg-maroon{background-color:var(--maroon);} 
    .text-maroon{color:var(--maroon);}
    .text-gold{color:var(--gold);} 
    .bg-gold{background-color:var(--gold);}
    button { transition: all 0.2s; }
    button:hover { opacity: 0.9; }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center">
  <div class="bg-white p-8 rounded-xl shadow-md w-full max-w-md">
    <h1 class="text-3xl font-bold text-maroon mb-6 text-center">Login</h1>
    <div id="errorMessage" class="text-red-600 font-semibold mb-4 text-center"></div>
    <form id="loginForm" class="space-y-4">
      <div>
        <label class="block text-maroon font-semibold">Email</label>
        <input type="email" id="emailInput" class="w-full mt-1 p-2 border border-gray-300 rounded-md" required>
      </div>
      <div>
        <label class="block text-maroon font-semibold">Password</label>
        <input type="password" id="passwordInput" class="w-full mt-1 p-2 border border-gray-300 rounded-md" required>
      </div>
      <button type="submit" class="w-full bg-maroon text-gold font-bold py-2 rounded-md">Login</button>
    </form>
  </div>

  <script>
    // ---------- SUPABASE SETUP ----------
    const SUPABASE_URL = "https://zchofpncqskvnfrzbcww.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpjaG9mcG5jcXNrdm5mcnpiY3d3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk5NDI4NDIsImV4cCI6MjA3NTUxODg0Mn0.U-Zm4slsBcWHSpfhjM8jvBvtt8YCPMAiSopWR9-YXUI";
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const loginForm = document.getElementById("loginForm");
    const errorDiv = document.getElementById("errorMessage");

    loginForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      errorDiv.textContent = "";

      const email = document.getElementById("emailInput").value.trim();
      const password = document.getElementById("passwordInput").value.trim();

      if (!email || !password) {
        errorDiv.textContent = "Please enter both email and password.";
        return;
      }

      try {
        // Check email and password in 'users' table
        const { data: user, error } = await supabase
          .from('users')
          .select('id, full_name, email, phone, password') // Make sure 'password' exists in table
          .eq('email', email)
          .single();

        if (error || !user) {
          errorDiv.textContent = "User not found.";
          return;
        }

        // Simple password check (replace with hashed password logic if needed)
        if (user.password !== password) {
          errorDiv.textContent = "Incorrect password.";
          return;
        }

        // Save email in localStorage for profile page
        localStorage.setItem('client_email', user.email);

        // Redirect to profile page
        window.location.href = "profile.html";

      } catch (err) {
        console.error("Login error:", err);
        errorDiv.textContent = "An unexpected error occurred. Try again.";
      }
    });
  </script>
</body>
</html>














