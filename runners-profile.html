<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Runner HQ - Run Me An Errand</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root { --maroon: #7B1E3A; --gold: #FFD700; --dark: #1a1a1a; --light-bg: #f8fafc; --success: #22c55e; }
        body { font-family: 'Montserrat', sans-serif; margin: 0; background: var(--light-bg); color: var(--dark); padding-bottom: 40px; }
        
        .top-nav { background: var(--maroon); padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; color: white; position: sticky; top: 0; z-index: 100; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .dashboard-content { max-width: 500px; margin: 0 auto; padding: 20px; }

        /* Announcement Bar */
        .notice-board { background: #fff3cd; border: 1px solid #ffeeba; padding: 12px; border-radius: 15px; margin-bottom: 20px; font-size: 11px; font-weight: 700; color: #856404; display: flex; align-items: center; gap: 10px; }

        .runner-card { background: white; border-radius: 24px; padding: 25px; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.05); margin-bottom: 20px; border: 1px solid #edf2f7; }
        .profile-img { width: 100px; height: 100px; border-radius: 30px; object-fit: cover; border: 3px solid var(--maroon); margin-bottom: 15px; }
        
        .status-pill { display: inline-block; padding: 5px 15px; border-radius: 20px; font-size: 10px; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; }

        .action-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .action-card { background: white; padding: 20px; border-radius: 20px; text-align: center; border: 1px solid #edf2f7; cursor: pointer; }
        .action-card i { font-size: 1.5rem; color: var(--maroon); margin-bottom: 10px; display: block; }
        .action-card span { font-size: 11px; font-weight: 700; color: #64748b; text-transform: uppercase; }

        .availability-box { background: white; padding: 20px; border-radius: 20px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-left: 5px solid var(--success); }

        /* Toggle Switch */
        .switch { position: relative; display: inline-block; width: 50px; height: 26px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--success); }
        input:checked + .slider:before { transform: translateX(24px); }

        .wallet-card { background: var(--dark); color: white; padding: 25px; border-radius: 24px; margin-bottom: 20px; background-image: linear-gradient(to right bottom, #1a1a1a, #2d1a1e); }
        
        .btn-whatsapp { width: 100%; padding: 15px; background: #25D366; color: white; border: none; border-radius: 15px; font-weight: 800; text-transform: uppercase; font-size: 11px; cursor: pointer; margin-bottom: 10px; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .btn-safety { width: 100%; padding: 15px; background: white; color: var(--maroon); border: 2px solid var(--maroon); border-radius: 15px; font-weight: 800; text-transform: uppercase; font-size: 11px; cursor: pointer; margin-bottom: 20px; }
        .btn-logout { width: 100%; padding: 15px; background: #fee2e2; color: #ef4444; border: none; border-radius: 15px; font-weight: 800; text-transform: uppercase; font-size: 11px; cursor: pointer; }
    </style>
</head>
<body>

    <div class="top-nav">
        <span style="font-weight: 800; letter-spacing: -1px;">RUNNER HQ</span>
        <i class="fas fa-cog" onclick="alert('Settings coming soon')"></i>
    </div>

    <div class="dashboard-content">
        
        <div class="notice-board">
            <i class="fas fa-bullhorn"></i>
            <span>Tip: Always verify M-Pesa names before starting an errand!</span>
        </div>

        <div class="runner-card">
            <div id="statusLabel" class="status-pill bg-gray-100 text-gray-500">Loading...</div>
            <br>
            <img id="runnerImg" src="https://via.placeholder.com/100" class="profile-img">
            <h2 id="runnerName" style="margin: 0; font-weight: 800; text-transform: capitalize;">---</h2>
            <p id="runnerLocation" style="font-size: 12px; color: #64748b; font-weight: 600;"><i class="fas fa-map-marker-alt"></i> ---</p>
        </div>

        <div class="availability-box">
            <div>
                <p style="margin: 0; font-size: 14px; font-weight: 800;">Profile Visibility</p>
                <p id="onlineStatusText" style="margin: 0; font-size: 11px; color: #22c55e; font-weight: 700;">Online & Ready</p>
            </div>
            <label class="switch">
                <input type="checkbox" id="availabilityToggle" checked>
                <span class="slider"></span>
            </label>
        </div>

        <div class="action-grid">
            <div class="action-card" style="border-bottom: 3px solid var(--maroon);">
                <h2 id="errandCount" style="margin:0; font-weight: 800;">0</h2>
                <span>Errands</span>
            </div>
            <div class="action-card" style="border-bottom: 3px solid var(--gold);">
                <h2 id="profileViews" style="margin:0; font-weight: 800;">0</h2>
                <span>Views</span>
            </div>
        </div>

        <div class="action-grid">
            <div class="action-card" onclick="alert('Edit Rates: Coming Soon')">
                <i class="fas fa-wallet"></i>
                <span>Rates</span>
            </div>
            <div class="action-card" onclick="alert('Edit Profile: Coming Soon')">
                <i class="fas fa-id-card"></i>
                <span>Bio</span>
            </div>
        </div>

        <div class="wallet-card">
            <p style="font-size: 10px; font-weight: 800; color: #94a3b8; text-transform: uppercase; margin-bottom: 5px;">Subscription</p>
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h3 id="subStatus" style="margin: 0; font-weight: 800;">---</h3>
                <button style="background: var(--gold); color: var(--maroon); border: none; padding: 8px 15px; border-radius: 10px; font-weight: 800; font-size: 11px;">RENEW</button>
            </div>
        </div>

        <button class="btn-whatsapp" onclick="shareProfile()">
            <i class="fab fa-whatsapp"></i> Share My Pro Profile
        </button>

        <button class="btn-safety" onclick="alert('1. Confirm errand details\n2. Verify client via WhatsApp\n3. Take photos of receipts\n4. Never pay with your own money first!')">
            <i class="fas fa-shield-alt"></i> Safety Checklist
        </button>

        <button class="btn-logout" id="logoutBtn">Secure Logout</button>
    </div>

    <script>
        const supabaseConfig = {
            url: "https://zchofpncqskvnfrzbcww.supabase.co",
            key: "YOUR_SUPABASE_KEY" // Same key as your login/signup
        };
        const supabaseClient = window.supabase.createClient(supabaseConfig.url, supabaseConfig.key);

        async function loadRunnerHQ() {
            const email = localStorage.getItem("loggedInEmail");
            if (!email) { window.location.href = "login.html"; return; }

            const { data, error } = await supabaseClient
                .from("runners")
                .select("*")
                .eq("email", email.trim())
                .single();

            if (data) {
                document.getElementById("runnerName").innerText = data.name;
                document.getElementById("runnerLocation").innerText = data.location;
                document.getElementById("runnerImg").src = data.profilepicture || "https://via.placeholder.com/100";
                document.getElementById("profileViews").innerText = data.profile_views || 0;
                
                // Set Toggle
                const availabilityToggle = document.getElementById("availabilityToggle");
                const statusText = document.getElementById("onlineStatusText");
                availabilityToggle.checked = data.is_online;
                statusText.innerText = data.is_online ? "Online & Ready" : "Offline (Hidden)";
                statusText.style.color = data.is_online ? "#22c55e" : "#ef4444";

                // Set Status Badge
                const statusLabel = document.getElementById("statusLabel");
                statusLabel.innerText = data.id_verified ? "✓ Verified Pro" : "⚠ Unverified";
                statusLabel.className = `status-pill ${data.id_verified ? 'bg-green-100 text-green-700' : 'bg-orange-100 text-orange-700'}`;

                // Subscription
                const subStatus = document.getElementById("subStatus");
                subStatus.innerText = data.subscription_status === 'active' ? 'ACTIVE' : 'EXPIRED';
                subStatus.style.color = data.subscription_status === 'active' ? '#22c55e' : '#ef4444';
            }
        }

        // Real-time Visibility Update
        document.getElementById("availabilityToggle").addEventListener("change", async function() {
            const email = localStorage.getItem("loggedInEmail");
            const isOnline = this.checked;
            const statusText = document.getElementById("onlineStatusText");

            statusText.innerText = isOnline ? "Online & Ready" : "Offline (Hidden)";
            statusText.style.color = isOnline ? "#22c55e" : "#ef4444";

            await supabaseClient.from("runners").update({ is_online: isOnline }).eq("email", email.trim());
        });

        function shareProfile() {
            const name = document.getElementById("runnerName").innerText;
            const text = `Hi, I am ${name}, a professional errand runner. See my services here: ${window.location.origin}/view-runner.html?email=${localStorage.getItem("loggedInEmail")}`;
            window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
        }

        document.getElementById("logoutBtn").addEventListener("click", () => {
            localStorage.clear();
            window.location.href = "login.html";
        });

        loadRunnerHQ();
    </script>
</body>
</html>











