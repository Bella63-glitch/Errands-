<!doctype html>
<html lang="en"> 
 <head> 
  <meta charset="UTF-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <title>Login | Run Me An Errand</title> 
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"> 
  <style>
        :root {
            --bg-dark: #121212;
            --bg-light: #f4f4f4;
            --maroon: #7B1E3A;
            --soft-red: #ff6b6b;
        }

        body {
            background-color: var(--bg-dark);
            transition: background-color 0.5s ease;
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0;
            overflow: hidden;
        }

        body.light-on { background-color: var(--bg-light); }
        body.error-pulse { background-color: #2a1212; }

        .login-container {
            width: 100%;
            max-width: 400px;
            z-index: 10;
        }

        .lamp-box {
            position: relative;
            height: 180px;
            display: flex;
            justify-content: center;
            margin-bottom: -10px;
        }

        .lamp-svg {
            width: 140px;
            height: auto;
            z-index: 5;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        body.light-on .lamp-svg { transform: scale(1.05); }

        .pull-cord {
            position: absolute;
            left: 58%;
            top: 65px;
            width: 2px;
            height: 50px;
            background: #555;
            cursor: pointer;
            transition: height 0.2s;
            z-index: 4;
        }

        .pull-cord:active { height: 65px; }

        .pull-cord::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: -4px;
            width: 10px;
            height: 10px;
            background: #222;
            border-radius: 50%;
        }

        .glow {
            position: absolute;
            top: 20px;
            width: 250px;
            height: 250px;
            background: radial-gradient(circle, rgba(255, 235, 59, 0.4) 0%, rgba(255, 235, 59, 0) 70%);
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.4s ease;
            pointer-events: none;
        }
        body.light-on .glow { opacity: 1; }

        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 30px;
            padding: 40px;
            transition: all 0.5s ease;
        }

        body.light-on .glass-card {
            background: #ffffff;
            border: 1px solid #ddd;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .input-wrapper { position: relative; }

        .input-field {
            background: rgba(255, 255, 255, 0.1);
            border: 1.5px solid transparent;
            color: white;
            border-radius: 15px;
            transition: all 0.3s;
        }

        body.light-on .input-field {
            background: #f9f9f9;
            border: 1.5px solid #eee;
            color: #333;
        }

        .eye-toggle {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #888;
            background: none;
            border: none;
            outline: none;
            transition: color 0.3s;
        }
        .eye-toggle:hover { color: var(--maroon); }

        .btn-main {
            background: var(--maroon);
            color: white;
            padding: 16px;
            border-radius: 15px;
            font-weight: 700;
            width: 100%;
            transition: all 0.3s;
        }
        .btn-main:active { transform: scale(0.98); }

        .label-text { color: #888; transition: color 0.3s; }
        body.light-on .label-text { color: #444; }
        body.light-on .heading { color: #111; }
        
        .home-link {
            position: relative;
            display: inline-block;
            transition: color 0.3s;
        }
        .home-link::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -2px;
            left: 0;
            background-color: var(--maroon);
            transition: width 0.3s ease;
        }
        .home-link:hover::after { width: 100%; }
        .home-link:hover { color: var(--maroon); }

        .eye, .mouth { transition: r 0.3s, d 0.3s; }

        #statusMsg {
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 107, 107, 0.2);
            background: rgba(255, 107, 107, 0.1);
            color: var(--soft-red);
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        .shake { animation: shake 0.4s ease-in-out; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
    </style> 
 </head> 
 <body> 
  <div class="login-container"> 
   <div class="lamp-box"> 
    <div class="glow"></div> 
    <div class="pull-cord" id="cord"></div> 
    <svg class="lamp-svg" id="lampSvg" viewbox="0 0 100 120"> <path id="shade" d="M20 70 L80 70 L70 20 L30 20 Z" fill="#333" /> <rect x="47" y="70" width="6" height="40" fill="#222" /> <ellipse cx="50" cy="110" rx="25" ry="5" fill="#111" /> <g id="eyesContainer"> 
      <circle id="eyeL" class="eye" cx="42" cy="45" r="2.5" fill="white" /> 
      <circle id="eyeR" class="eye" cx="58" cy="45" r="2.5" fill="white" /> 
     </g> <path id="mouth" class="mouth" d="M44 56 Q50 61 56 56" stroke="white" stroke-width="1.5" fill="none" stroke-linecap="round" /> 
    </svg> 
   </div> 
   <div class="glass-card"> 
    <h2 class="heading text-2xl font-black text-white text-center mb-2">Welcome Back</h2> 
    <p class="label-text text-center text-sm mb-6 font-medium">Please sign in to continue</p> 
    <div id="statusMsg" class="hidden mb-6 p-4 rounded-2xl text-xs font-semibold text-center"></div> 
    <div class="space-y-4"> 
     <input type="email" id="email" class="input-field w-full p-4 outline-none" placeholder="Email"> 
     <div class="input-wrapper"> 
      <input type="password" id="password" class="input-field w-full p-4 outline-none" placeholder="Password"> <button type="button" id="togglePass" class="eye-toggle"> 
       <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewbox="0 0 24 24" stroke="currentColor"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /> 
       </svg> </button> 
     </div> <button id="loginBtn" class="btn-main shadow-lg"> <span id="btnText">Sign In</span> </button> 
     <div class="text-center pt-4"> <a href="index.html" class="home-link label-text text-xs font-bold uppercase tracking-widest">Return Home</a> 
     </div> 
    </div> 
   </div> 
  </div> 
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script> 
  <script src="https://cdn.jsdelivr.net/npm/bcryptjs@2.4.3/dist/bcrypt.min.js"></script> 
  <script>
    const body = document.body;
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const togglePass = document.getElementById('togglePass');
    const cord = document.getElementById('cord');
    const shade = document.getElementById('shade');
    const eyeL = document.getElementById('eyeL');
    const eyeR = document.getElementById('eyeR');
    const mouth = document.getElementById('mouth');
    const statusMsg = document.getElementById('statusMsg');
    const loginBtn = document.getElementById('loginBtn');
    const btnText = document.getElementById('btnText');
    const lampSvg = document.getElementById('lampSvg');
    const eyesContainer = document.getElementById('eyesContainer');

    let isShocked = false;

    // 1. Interactive Eyes Script
    document.addEventListener('mousemove', (e) => {
        if (isShocked) return;
        const rect = lampSvg.getBoundingClientRect();
        const centerX = rect.left + rect.width / 2;
        const centerY = rect.top + rect.height / 2;
        
        const angle = Math.atan2(e.clientY - centerY, e.clientX - centerX);
        const distance = Math.min(2, Math.hypot(e.clientX - centerX, e.clientY - centerY) / 50);
        
        const moveX = Math.cos(angle) * distance;
        const moveY = Math.sin(angle) * distance;
        
        eyesContainer.style.transform = `translate(${moveX}px, ${moveY}px)`;
    });

    function setExpression(state) {
        if (state === 'shocked') {
            isShocked = true;
            eyeL.setAttribute('r', '4');
            eyeR.setAttribute('r', '4');
            mouth.setAttribute('d', 'M47 58 A3 3 0 1 0 53 58 A3 3 0 1 0 47 58');
        } else {
            isShocked = false;
            eyeL.setAttribute('r', '2.5');
            eyeR.setAttribute('r', '2.5');
            mouth.setAttribute('d', 'M44 56 Q50 61 56 56');
        }
    }

    function toggleLight(forceState) {
        const isOn = forceState !== undefined ? forceState : !body.classList.contains('light-on');
        if (isOn) {
            body.classList.add('light-on');
            shade.setAttribute('fill', '#7B1E3A');
        } else {
            body.classList.remove('light-on');
            shade.setAttribute('fill', '#333');
        }
    }

    togglePass.addEventListener('click', () => {
        const isPass = passwordInput.type === 'password';
        passwordInput.type = isPass ? 'text' : 'password';
    });

    function showError(msg) {
        statusMsg.textContent = msg;
        statusMsg.classList.remove('hidden');
        lampSvg.classList.add('shake');
        body.classList.add('error-pulse');
        setExpression('shocked');
        
        setTimeout(() => lampSvg.classList.remove('shake'), 400);

        setTimeout(() => {
            statusMsg.classList.add('hidden');
            body.classList.remove('error-pulse');
            setExpression('normal');
            emailInput.value = "";
            passwordInput.value = "";
            toggleLight(false);
            loginBtn.disabled = false;
            btnText.textContent = "Sign In";
        }, 3000);
    }

    cord.addEventListener('click', () => toggleLight());
    passwordInput.addEventListener('focus', () => toggleLight(true));

    (function() {
        const SUPABASE_URL = "https://zchofpncqskvnfrzbcww.supabase.co";
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpjaG9mcG5jcXNrdm5mcnpiY3d3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk5NDI4NDIsImV4cCI6MjA3NTUxODg0Mn0.U-Zm4slsBcWHSpfhjM8jvBvtt8YCPMAiSopWR9-YXUI";
        const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        loginBtn.addEventListener('click', async () => {
            const email = emailInput.value.trim();
            const password = passwordInput.value.trim();

            if (!email || !password) {
                showError("Oops! Please fill in all fields.");
                return;
            }

            loginBtn.disabled = true;
            btnText.innerHTML = '<div class="spinner mx-auto"></div>';

            try {
                let { data: user } = await supabaseClient.from('runners').select('*').eq('email', email).maybeSingle();
                let type = 'runner';

                if (!user) {
                    const { data: client } = await supabaseClient.from('users').select('*').eq('email', email).maybeSingle();
                    user = client;
                    type = 'client';
                }

                if (user && dcodeIO.bcrypt.compareSync(password, user.password)) {
                    localStorage.setItem('loggedInEmail', email);
                    localStorage.setItem('userType', type);
                    window.location.href = type === 'runner' ? 'runners-profile.html' : 'client-profile.html';
                } else {
                    showError("Hmm, those details don't look right.");
                }
            } catch (e) {
                showError("Something went wrong. Let's try that again.");
            }
        });
    })();
</script> 
 </body>
</html>





